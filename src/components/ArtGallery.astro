---
const { artItems } = Astro.props;
---
<section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="art-gallery">
  {artItems.map(art => (
    <div class="relative group">
      <img src={art.data.heroImage} alt={art.data.name} class="w-full h-auto object-contain shadow-lg cursor-pointer art-image" loading="lazy" data-art={JSON.stringify(art.data)} />
      <div class="mt-2">
        <h2 class="text-xl font-semibold">{art.data.name}</h2>
        {art.data.subtitle && <p class="text-sm italic text-light-blue">{art.data.subtitle}</p>}
        <p class="text-xs text-gray-400 mt-1">
          {art.data.dimensions}
          <span class="mx-2">•</span>
          <a href="#" class="text-gold hover:underline view-details" data-art={JSON.stringify(art.data)}>View details</a>
        </p>
      </div>
    </div>
  ))}
</section>

<div id="softbox" class="fixed inset-0 flex items-center justify-center z-50 hidden" style="background-color: rgba(5, 12, 25, 0.98);">
  <div class="w-full h-full flex flex-col p-4 softbox-content">
    <!-- Info and close button in same row -->
    <div class="flex justify-between items-start mb-2">
      <!-- Centered info - 3 lines -->
      <div class="flex-1 text-center text-white px-12">
        <h2 class="font-bold text-xl" id="softbox-name"></h2>
        <p class="italic text-base" id="softbox-subtitle"></p>
        <p class="text-xs text-light-blue">
          <span id="softbox-medium"></span> • <span id="softbox-dimensions"></span> • <span id="softbox-year"></span>
        </p>
      </div>
      <!-- Close button -->
      <button class="text-white text-5xl hover:opacity-75 leading-none ml-4" id="softbox-close">&times;</button>
    </div>
    
    <!-- Main image container - takes remaining space -->
    <div class="flex-1 flex items-center justify-center mb-4 min-h-0 softbox-content">
      <img id="softbox-img" src="" alt="" class="max-w-full max-h-full object-contain" />
    </div>
    
    <!-- Thumbnail gallery at bottom -->
    <div id="thumbnail-container" class="flex gap-2 justify-start md:justify-center overflow-x-auto pb-2 px-2 hidden" style="scroll-snap-type: x mandatory;">
    </div>
  </div>
</div>

<script>
  // Configuration: Change this value to adjust the border width around the main image (in pixels)
  const IMAGE_BORDER_WIDTH = 20; // Set to 0 for no border
  
  document.addEventListener('DOMContentLoaded', () => {
    const images = document.querySelectorAll('.art-image');
    const softbox = document.getElementById('softbox');
    const closeBtn = document.getElementById('softbox-close');
    const img = document.getElementById('softbox-img');
    const name = document.getElementById('softbox-name');
    const subtitle = document.getElementById('softbox-subtitle');
    const medium = document.getElementById('softbox-medium');
    const dimensions = document.getElementById('softbox-dimensions');
    const year = document.getElementById('softbox-year');
    const thumbnailContainer = document.getElementById('thumbnail-container');

    // Apply border to main image
    if (IMAGE_BORDER_WIDTH > 0) {
      img.style.border = `${IMAGE_BORDER_WIDTH}px solid white`;
    }

    let currentGallery = [];
    let currentIndex = 0;

    function updateImage(index) {
      currentIndex = index;
      img.src = currentGallery[currentIndex];
      
      // Update thumbnail active state
      const thumbnails = thumbnailContainer.querySelectorAll('img');
      thumbnails.forEach((thumb, i) => {
        if (i === currentIndex) {
          thumb.classList.add('border-4', 'border-white');
          thumb.classList.remove('opacity-60');
        } else {
          thumb.classList.remove('border-4', 'border-white');
          thumb.classList.add('opacity-60');
        }
      });
    }

    function openSoftbox(data) {
      currentGallery = [data.heroImage];
      if (data.galleryImages && data.galleryImages.length > 0) {
        currentGallery = currentGallery.concat(data.galleryImages);
      }
      currentIndex = 0;
      
      img.src = currentGallery[0];
      img.alt = data.name;
      name.textContent = data.name;
      subtitle.textContent = data.subtitle || '';
      medium.textContent = data.medium;
      dimensions.textContent = data.dimensions;
      year.textContent = data.year;
      
      thumbnailContainer.innerHTML = '';
      if (currentGallery.length > 1) {
        currentGallery.forEach((imgSrc, index) => {
          const thumb = document.createElement('img');
          thumb.src = imgSrc;
          thumb.className = 'h-20 w-auto object-cover cursor-pointer hover:opacity-100';
          if (index === 0) {
            thumb.classList.add('border-4', 'border-white');
          } else {
            thumb.classList.add('opacity-60');
          }
          thumb.onclick = () => updateImage(index);
          thumbnailContainer.appendChild(thumb);
        });
        thumbnailContainer.classList.remove('hidden');
      } else {
        thumbnailContainer.classList.add('hidden');
      }
      
      softbox.classList.remove('hidden');
    }

    images.forEach(image => {
      image.onclick = () => {
        const data = JSON.parse(image.getAttribute('data-art'));
        openSoftbox(data);
      };
    });

    document.querySelectorAll('.view-details').forEach(link => {
      link.onclick = (e) => {
        e.preventDefault();
        const data = JSON.parse(link.getAttribute('data-art'));
        openSoftbox(data);
      };
    });

    closeBtn.onclick = () => {
      softbox.classList.add('hidden');
    };
    
    // Close softbox if click on background
    softbox.addEventListener('click', (e) => {
      if (e.target === softbox || e.target.classList.contains('softbox-content')) {
        softbox.classList.add('hidden');
      }
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (!softbox.classList.contains('hidden')) {
        if (e.key === 'ArrowLeft' && currentIndex > 0) {
          updateImage(currentIndex - 1);
        } else if (e.key === 'ArrowRight' && currentIndex < currentGallery.length - 1) {
          updateImage(currentIndex + 1);
        } else if (e.key === 'Escape') {
          softbox.classList.add('hidden');
        }
      }
    });

    // Touch swipe navigation
    let touchStartX = 0;
    let touchEndX = 0;
    const minSwipeDistance = 50;

    img.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });

    img.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      const swipeDistance = touchEndX - touchStartX;
      
      if (Math.abs(swipeDistance) > minSwipeDistance) {
        if (swipeDistance < 0 && currentIndex < currentGallery.length - 1) {
          updateImage(currentIndex + 1);
        } else if (swipeDistance > 0 && currentIndex > 0) {
          updateImage(currentIndex - 1);
        }
      }
    }, { passive: true });
  });
</script>
