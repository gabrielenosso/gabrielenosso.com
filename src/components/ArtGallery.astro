---
const { artItems } = Astro.props;
---
<section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="art-gallery">
  {artItems.map(art => (
    <div class="relative group">
      <img src={art.data.heroImage} alt={art.data.name} class="w-full h-auto object-contain rounded shadow-lg cursor-pointer art-image" loading="lazy" data-art={JSON.stringify(art.data)} />
      <div class="mt-2">
        <h2 class="text-xl font-semibold">{art.data.name}</h2>
        {art.data.subtitle && <p class="text-sm italic text-gray-500 dark:text-gray-400">{art.data.subtitle}</p>}
      </div>
    </div>
  ))}
</section>

<div id="softbox" class="fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50 hidden">
  <div class="w-full h-full flex flex-col p-4">
    <!-- Top bar with info and close button -->
    <div class="flex justify-between items-start mb-4 text-white gap-6">
      <!-- First column: Title, subtitle, medium, dimensions, year -->
      <div class="flex flex-col gap-1 text-sm whitespace-nowrap">
        <h2 class="font-bold text-base" id="softbox-name"></h2>
        <p class="italic" id="softbox-subtitle"></p>
        <p id="softbox-medium"></p>
        <p id="softbox-dimensions"></p>
        <p id="softbox-year"></p>
      </div>
      
      <!-- Second column: Description (takes remaining space) -->
      <p class="flex-1 text-sm" id="softbox-text"></p>
      
      <!-- Close button -->
      <button class="text-3xl hover:opacity-75" id="softbox-close">&times;</button>
    </div>
    
    <!-- Main image container - takes remaining space -->
    <div class="flex-1 flex items-center justify-center mb-4 min-h-0">
      <img id="softbox-img" src="" alt="" class="max-w-full max-h-full object-contain" />
    </div>
    
    <!-- Thumbnail gallery at bottom -->
    <div id="thumbnail-container" class="flex gap-2 justify-center overflow-x-auto pb-2 hidden">
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const images = document.querySelectorAll('.art-image');
    const softbox = document.getElementById('softbox');
    const closeBtn = document.getElementById('softbox-close');
    const img = document.getElementById('softbox-img');
    const name = document.getElementById('softbox-name');
    const subtitle = document.getElementById('softbox-subtitle');
    const medium = document.getElementById('softbox-medium');
    const dimensions = document.getElementById('softbox-dimensions');
    const year = document.getElementById('softbox-year');
    const text = document.getElementById('softbox-text');
    const thumbnailContainer = document.getElementById('thumbnail-container');

    let currentGallery = [];
    let currentIndex = 0;

    function updateImage(index) {
      currentIndex = index;
      img.src = currentGallery[currentIndex];
      
      // Update thumbnail active state
      const thumbnails = thumbnailContainer.querySelectorAll('img');
      thumbnails.forEach((thumb, i) => {
        if (i === currentIndex) {
          thumb.classList.add('ring-4', 'ring-white');
          thumb.classList.remove('opacity-60');
        } else {
          thumb.classList.remove('ring-4', 'ring-white');
          thumb.classList.add('opacity-60');
        }
      });
    }

    images.forEach(image => {
      image.onclick = () => {
        const data = JSON.parse(image.getAttribute('data-art'));
        
        // Build gallery array: heroImage first, then galleryImages
        currentGallery = [data.heroImage];
        if (data.galleryImages && data.galleryImages.length > 0) {
          currentGallery = currentGallery.concat(data.galleryImages);
        }
        currentIndex = 0;
        
        img.src = currentGallery[0];
        img.alt = data.name;
        name.textContent = data.name;
        subtitle.textContent = data.subtitle || '';
        medium.textContent = data.medium;
        dimensions.textContent = data.dimensions;
        year.textContent = data.year;
        text.textContent = data.text;
        
        // Build thumbnails
        thumbnailContainer.innerHTML = '';
        if (currentGallery.length > 1) {
          currentGallery.forEach((imgSrc, index) => {
            const thumb = document.createElement('img');
            thumb.src = imgSrc;
            thumb.className = 'h-20 w-auto object-cover cursor-pointer rounded transition-all hover:opacity-100';
            if (index === 0) {
              thumb.classList.add('ring-4', 'ring-white');
            } else {
              thumb.classList.add('opacity-60');
            }
            thumb.onclick = () => updateImage(index);
            thumbnailContainer.appendChild(thumb);
          });
          thumbnailContainer.classList.remove('hidden');
        } else {
          thumbnailContainer.classList.add('hidden');
        }
        
        softbox.classList.remove('hidden');
      };
    });

    closeBtn.onclick = () => {
      softbox.classList.add('hidden');
    };
    
    // Close softbox if click on background
    softbox.addEventListener('click', (e) => {
      if (e.target === softbox) {
        softbox.classList.add('hidden');
      }
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (!softbox.classList.contains('hidden')) {
        if (e.key === 'ArrowLeft' && currentIndex > 0) {
          updateImage(currentIndex - 1);
        } else if (e.key === 'ArrowRight' && currentIndex < currentGallery.length - 1) {
          updateImage(currentIndex + 1);
        } else if (e.key === 'Escape') {
          softbox.classList.add('hidden');
        }
      }
    });
  });
</script>
